<umb-editor-view ng-controller="Umbraco.Editors.Translation.TasksController">

    <umb-editor-header name="labels.pageTitle"
                       hide-icon="true"
                       hide-description="true"
                       hide-alias="true"
                       name-locked="true">
    </umb-editor-header>

    <umb-editor-container>

        <div class="umb-loader-wrapper" ng-show="loading === true">
            <div class="umb-loader"></div>
        </div>

        <ng-container ng-if="loading === false">
            <ng-container ng-if="tasks.length === 0">
                <localize key="translation_noTask"></localize>
            </ng-container>
            <ng-container ng-if="tasks.length !== 0">

                <umb-box>
                    <umb-box-header title="Actions"></umb-box-header>
                    <umb-box-content class="block-form">
                        <div class="flex">
                            <div class="flx-i" style="margin-right:50px;">
                                <umb-control-group label="@translation_downloadAllAsXml">
                                    <umb-button type="button"
                                                action="download(tasks)"
                                                button-style="primary"
                                                label-key="general_download">Download</umb-button>
                                </umb-control-group>
                            </div>
                            <div class="flx-i">
                                <umb-control-group label="@translation_uploadTranslationXml">
                                    <span ngf-select
                                          ngf-change="upload($files)"
                                          ngf-multiple="true">
                                        <umb-button type="button"
                                                    button-style="primary"
                                                    state="uploadButtonState"
                                                    label-key="general_upload">Upload</umb-button>
                                    </span>
                                </umb-control-group>
                            </div>
                        </div>

                        <ng-container ng-if="report !== null">
                            <div class="alert alert-success alert-dismissible" role="alert" style="margin-bottom:0;" ng-if="report.errorCount === 0 && report.successCount !== 0">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="color:#fff"><span aria-hidden="true" ng-click="hideReport()">&times;</span></button>
                                <localize key="translation_translationDone"></localize>
                            </div>

                            <div class="alert alert-warning alert-dismissible" role="alert" style="margin-bottom:0;" ng-if="report.errorCount !== 0 && report.successCount !== 0">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="color:#fff"><span aria-hidden="true" ng-click="hideReport()">&times;</span></button>
                                <localize key="translation_translationDoneWithError"></localize>
                            </div>

                            <div class="alert alert-error alert-dismissible" role="alert" style="margin-bottom:0;" ng-if="report.errorCount !== 0 && report.successCount === 0">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="color:#fff"><span aria-hidden="true" ng-click="hideReport()">&times;</span></button>
                                <localize key="translation_translationFailed"></localize>
                            </div>
                        </ng-container>
                    </umb-box-content>
                </umb-box>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>
                                <localize key="general_name">Name</localize>
                            </th>
                            <th>
                                <localize key="translation_taskAssignedBy">Assigned by</localize>
                            </th>
                            <th>
                                <localize key="general_date">Date</localize>
                            </th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="task in tasks track by $index">
                            <td class="bold">
                                {{ task.properties[0].value }} <i class="icon-check color-green" style="margin-left:10px;" ng-if="task.done === true"></i><i class="icon-remove color-red" style="margin-left:10px;" ng-if="task.failed === true"></i>
                            </td>
                            <td>
                                <div class="flex" style="align-items:center;">
                                    <umb-avatar size="xs"
                                                name="{{ task.assignedBy.name }}"
                                                img-src="{{ task.assignedBy.avatars[0] }}"
                                                img-srcset="{{ task.assignedBy.avatars[1] }} 2x, {{ task.assignedBy.avatars[2] }} 3x">
                                    </umb-avatar>
                                    <div style="margin-left:15px">{{ task.assignedBy.name }}</div>
                                </div>
                            </td>
                            <td>{{ task.createdDate | date:'fullDate' }}</td>
                            <td>
                                <umb-button type="button"
                                            ng-if="!task.done"
                                            action="openTask(task)"
                                            button-style="primary"
                                            label-key="translation_details">Translation details</umb-button>
                            </td>
                            <td>
                                <umb-button type="button"
                                            ng-if="!task.done"
                                            action="download([task])"
                                            button-style="primary"
                                            label-key="translation_downloadTaskAsXml">Download XML</umb-button>
                                <umb-button type="button"
                                            ng-if="task.done === true"
                                            action="preview(task)"
                                            button-style="primary"
                                            label-key="general_preview">Preview</umb-button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </ng-container>
        </ng-container>
    </umb-editor-container>

</umb-editor-view>
